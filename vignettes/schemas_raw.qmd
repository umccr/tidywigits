---
title: "Schemas Raw"
vignette: >
  %\VignetteIndexEntry{Schemas Raw}
  %\VignetteEngine{quarto::html}
  %\VignetteEncoding{UTF-8}
knitr:
  opts_chunk:
    collapse: true
    comment: '#>'
    echo: false
---

```{r}
#| label: pkgs
#| message: false
{
  use("tidywigits", "WIGITS_TOOLS")
  use("nemo", "Config")
  use("dplyr")
  use("glue", "glue")
  use("purrr", "map")
  use("readr", "read_tsv")
  use("tibble", "tibble")
  use("tidyr", "unnest")
  use("reactable", "reactable")
  use("htmltools", c("HTML", "tags"))
}
vignettes_script <- system.file("scripts/vignettes/schemas.R", package = "nemo")
source(vignettes_script)
```

```{r}
#| label: read_configs
tools <- WIGITS_TOOLS
get_schemas_raw <- function(tool) {
  conf <- nemo::Config$new(tool, pkg = "tidywigits")
  .get_raw <- function() {
    pats <- conf$get_raw_patterns()
    desc <- conf$get_raw_descriptions()
    conf$raw_schemas_all |>
      dplyr::left_join(desc, by = "name") |>
      dplyr::left_join(pats, by = "name", suffix = c("_descr", "_pattern")) |>
      dplyr::select(
        tbl = "name",
        description = "value_descr",
        pattern = "value_pattern",
        "version",
        "schema"
      )
  }
  .get_raw()
}

d <- purrr::map(tools, get_schemas_raw) |>
  purrr::set_names(toupper(tools)) |>
  dplyr::bind_rows(.id = "tool") |>
  tidyr::nest(schema_version = c("version", "schema")) |>
  dplyr::mutate(row_id = row_number(), n = .data$row_id) |>
  dplyr::relocate("n") |>
  dplyr::relocate("schema_version", .after = "tbl")
```

```{r}
#| label: reactable_schema
reactable_schema(d)
```
