---
title: "PostgreSQL"
vignette: >
  %\VignetteIndexEntry{PostgreSQL}
  %\VignetteEngine{quarto::html}
  %\VignetteEncoding{UTF-8}
knitr:
  opts_chunk:
    collapse: true
    comment: '#>'
    echo: false
---

## Schema generation

Schema was generated by:

- Write OA v1 tables

```r
dbconn <- DBI::dbConnect(
  drv = RPostgres::Postgres(),
  dbname = "nemo",
  user = "orcabus"
)
Oncoanalyser$new("nogit/oa_v1")
oa$magic(format = "db", id = "oa_run_v1", dbconn = dbconn)
DBI::dbDisconnect(dbconn)
```

```shell
pg_dump --schema-only nemo > schema_oa_v1.txt
dropdb --force nemo
createdb nemo
```

- Write OA v2 tables

```r
dbconn <- DBI::dbConnect(
  drv = RPostgres::Postgres(),
  dbname = "nemo",
  user = "orcabus"
)
Oncoanalyser$new("nogit/oa_v2")
oa$magic(format = "db", id = "oa_run_v2", dbconn = dbconn)
DBI::dbDisconnect(dbconn)
```

```shell
pg_dump --schema-only nemo > schema_oa_v2.txt
dropdb --force nemo
```

- Merge schemas

After diffing the two schemas a merged one was (manually) created.

## Database creation

```
createdb nemo
cat schema1.sql | psql nemo
```

### Result

```text
select * from pg_catalog.pg_tables where schemaname='public';
 schemaname │          tablename          │ tableowner │ tablespace │ hasindexes │ hasrules │ hastriggers │ rowsecurity
════════════╪═════════════════════════════╪════════════╪════════════╪════════════╪══════════╪═════════════╪═════════════
 public     │ amber_contaminationtsv      │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ alignments_dupfreq          │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ alignments_markdup_histo    │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ alignments_markdup_metrics  │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ amber_bafpcf                │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ amber_baftsv                │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ amber_homozygousregion      │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ bamtools_coverage           │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ amber_qc                    │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ bamtools_flagstats          │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ bamtools_fraglength         │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ bamtools_partitionstats     │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ bamtools_summary            │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ bamtools_summary_covx       │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ bamtools_wgsmetrics_metrics │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ bamtools_wgsmetrics_histo   │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ chord_prediction            │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ chord_signatures            │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ cobalt_gcmed_bucket_stats   │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ cobalt_gcmed_sample_stats   │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ cobalt_ratiomed             │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ cobalt_ratiopcf             │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ cobalt_ratiotsv             │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ cobalt_version              │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ cuppa_datacsv               │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ cuppa_datatsv               │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ cuppa_feat                  │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ cuppa_predsum               │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ flagstats_flagstats         │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ isofox_altsj                │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ isofox_fusionsall           │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ isofox_fusionspass          │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ isofox_retintron            │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ isofox_genecollection       │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ isofox_genedata             │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ isofox_summary              │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ isofox_transdata            │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ lilac_qc                    │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ lilac_summary               │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ linx_breakends              │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ linx_clusters               │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ linx_drivercatalog          │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ linx_version                │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ linx_drivers                │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ linx_fusions                │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ linx_links                  │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ linx_neoepitope             │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ linx_svs                    │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ linx_visgeneexon            │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ linx_viscn                  │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ linx_visfusion              │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ linx_visproteindomain       │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ linx_vissegments            │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ linx_vissvdata              │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ purple_cnvgenetsv           │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ purple_cnvsomtsv            │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ purple_drivercatalog        │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ purple_germdeltsv           │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ purple_purityrange          │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ purple_puritytsv            │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ purple_qc                   │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ purple_somclonality         │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ purple_somhist              │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ sage_exoncvg                │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ purple_version              │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ sage_bqrtsv                 │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ sage_genecvg_cvg            │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ sage_genecvg_genes          │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ sigs_allocation             │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ sigs_snvcounts              │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ virusbreakend_summary       │ orcabus    │ ¤          │ f          │ f        │ f           │ f
 public     │ virusinterpreter_annotated  │ orcabus    │ ¤          │ f          │ f        │ f           │ f
(72 rows)
```
